      - name: Run server + client (smoke)
        shell: bash
        run: |
          set -euo pipefail

          # Démarre le serveur (logs dans server.log)
          dotnet run --project data/DATA0_RawStore/DATA0_RawStore.csproj -- server --url http://127.0.0.1:5080 > server.log 2>&1 &
          SERVER_PID=$!
          trap "kill $SERVER_PID || true" EXIT

          # Attendre que /health réponde (max 20s)
          for i in {1..20}; do
            if curl -fsS http://127.0.0.1:5080/health > /dev/null; then
              echo "Server is up"
              break
            fi
            sleep 1
          done

          # Vérifier que le serveur est bien up
          curl -fsS http://127.0.0.1:5080/health > /dev/null

          # Lancer le client
          OUTPUT=$(dotnet run --project data/DATA0_RawStore/DATA0_RawStore.csproj -- client http://127.0.0.1:5080 COM1 bonjour) || (cat server.log; exit 1)
          echo "$OUTPUT"

          # Condition smoke
          echo "$OUTPUT" | grep -q "SMOKE: ok"
